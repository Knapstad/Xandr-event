___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Xandr event",
  "categories": ["ANALYTICS", "ADVERTISING", "MARKETING", "REMARKETING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Custom Template",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Fire xander events",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "UNIVERSAL_PIXEL_UUID",
    "displayName": "Your universal pixel id",
    "simpleValueType": true,
    "notSetText": "Your Pixel Id must be set",
    "help": "The universal pixel id is the idyou generated during the universal pixel creation, it looks something like this \u0027a58fde5b-f991-474f-\n9456-b2509ba30042\u0027"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Log debug messages to console",
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "event_type",
    "displayName": "Event",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "LandingPage",
        "displayValue": "LandingPage"
      },
      {
        "value": "ItemView",
        "displayValue": "ItemView"
      },
      {
        "value": "AddToCart",
        "displayValue": "AddToCart"
      },
      {
        "value": "InitiateCheckout",
        "displayValue": "InitiateCheckout"
      },
      {
        "value": "AddPaymentInfo",
        "displayValue": "AddPaymentInfo"
      },
      {
        "value": "Purchase",
        "displayValue": "Purchase"
      },
      {
        "value": "Lead",
        "displayValue": "Lead"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "use_params",
    "checkboxText": "Use parameters",
    "simpleValueType": true,
    "subParams": [
      {
        "type": "GROUP",
        "name": "params",
        "displayName": "",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "TEXT",
            "name": "Item_id",
            "displayName": "Item_id",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "Item_type",
            "displayName": "Item_type",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "Item_name",
            "displayName": "Item_name",
            "simpleValueType": true
          }
        ],
        "enablingConditions": [
          {
            "paramName": "use_params",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const copyFromWindow = require('copyFromWindow');
const createQueue = require('createQueue');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const JSON = require('JSON');
const log = data.debug ? logToConsole : () => {};
const tracking_id = data.UNIVERSAL_PIXEL_UUID;
const use_params = data.use_params;
const event_type = data.event_type;
const item_id = data.Item_id;
const item_type = data.Item_type;
const item_name = data.Item_name;

const onSuccess = () => {
  log('Xandr: Pixie event loaded');
  data.gtmOnSuccess();
};

const onFailure = () => {
  log('Xandr: Pixie event failed.');
  data.gtmOnFailure();
};

let pixie = copyFromWindow('pixie');
if (!pixie) {
  log("xander event: pixie not pressent, loading");
  let pQ;
  setInWindow('pixie', (e, i, a) => {
    pQ({ action: e, actionValue: i, params: a });
  });
  pQ = createQueue('pixie.actionQueue');
  pixie = copyFromWindow('pixie');
  pixie('init', tracking_id);
}

if (use_params) {
  const params = {item_id: item_id, item_type: item_type, item_name: item_name};
  log("use_params: " + "use_params sending with params");
  pixie('event', event_type, params);
} else {
  log("no params");
  pixie('event', event_type);
}

const url = 'https://acdn.adnxs.com/dmp/up/pixie.js';
injectScript(url, onSuccess, onFailure, url);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://acdn.adnxs.com/dmp/up/pixie.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pixie"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pixie.actionQueue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/09/2020, 10:12:40


