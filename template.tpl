___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Xandr event",
  "categories": [
    "ANALYTICS",
    "ADVERTISING",
    "MARKETING",
    "REMARKETING"
  ],
  "brand": {
    "id": "github.com_Knapstad",
    "displayName": "Knapstad",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Unofficial template to fire Xander events",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "UNIVERSAL_PIXEL_UUID",
    "displayName": "Your universal pixel id",
    "simpleValueType": true,
    "notSetText": "Your Pixel Id must be set",
    "help": "The universal pixel id is the idyou generated during the universal pixel creation, it looks something like this \u0027a58fde5b-f991-474f-\n9456-b2509ba30042\u0027"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Log debug messages to console",
    "simpleValueType": true
  },
  {
    "type": "RADIO",
    "name": "event_type",
    "displayName": "",
    "radioItems": [
      {
        "value": "default_events",
        "displayValue": "Default events",
        "subParams": [
          {
            "type": "SELECT",
            "name": "default_event",
            "displayName": "Event",
            "macrosInSelect": false,
            "selectItems": [
              {
                "value": "LandingPage",
                "displayValue": "LandingPage"
              },
              {
                "value": "ItemView",
                "displayValue": "ItemView"
              },
              {
                "value": "AddToCart",
                "displayValue": "AddToCart"
              },
              {
                "value": "InitiateCheckout",
                "displayValue": "InitiateCheckout"
              },
              {
                "value": "AddPaymentInfo",
                "displayValue": "AddPaymentInfo"
              },
              {
                "value": "Purchase",
                "displayValue": "Purchase"
              },
              {
                "value": "Lead",
                "displayValue": "Lead"
              },
              {
                "value": "PageView",
                "displayValue": "PageView"
              }
            ],
            "simpleValueType": true
          }
        ]
      },
      {
        "value": "custom_events",
        "displayValue": "Custom event",
        "subParams": [
          {
            "type": "TEXT",
            "name": "custom_event",
            "displayName": "Custom Event",
            "simpleValueType": true
          }
        ]
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "use_params",
    "checkboxText": "Use parameters",
    "simpleValueType": true,
    "subParams": [
      {
        "type": "GROUP",
        "name": "params",
        "displayName": "",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "TEXT",
            "name": "Item_id",
            "displayName": "Item_id",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "Item_type",
            "displayName": "Item_type",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "Item_name",
            "displayName": "Item_name",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "value",
            "displayName": "value",
            "simpleValueType": true
          }
        ],
        "enablingConditions": [
          {
            "paramName": "use_params",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const copyFromWindow = require('copyFromWindow');
const createQueue = require('createQueue');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const JSON = require('JSON');
const log = data.debug ? logToConsole : () => {};
const tracking_id = data.UNIVERSAL_PIXEL_UUID;
const use_params = data.use_params;
const event_type = data.event_type;
const item_id = data.Item_id;
const item_type = data.Item_type;
const item_name = data.Item_name;
const value = data.value;
const default_event = data.default_event;
const custom_event = data.custom_event;
const custom_params = data.custom_parameters;


const onSuccess = () => {
  log('Xandr: Pixie event loaded');
  log('event_type: ' + event_type);
  log('custom_event: ' + custom_event);
  log('default_event: ' + default_event);
  data.gtmOnSuccess();
};

const onFailure = () => {
  log('Xandr: Pixie event failed.');
  data.gtmOnFailure();
};

let pixie = copyFromWindow('pixie');
if (!pixie) {
  log("xander event: pixie not present, loading");
  let pQ;
  setInWindow('pixie', (e, i, a) => {
    pQ({ action: e, actionValue: i, params: a });
  });
  pQ = createQueue('pixie.actionQueue');
  pixie = copyFromWindow('pixie');
  pixie('init', tracking_id);
}

let event;
if(event_type =='default_events'){
  event = default_event;
  log('event: ' + event);
} else {
  event = custom_event;
  log('event: ' + event);
}
let params = {};
if (use_params){
  params = {item_id: item_id, item_type: item_type, item_name: item_name, value: value};
  log("use_params: " + "use_params == true, sending with parameters, event: " + event);
  pixie('event', event, params);
} else {
  log("no params, event:" + event);
  pixie('event', event);
}

const url = 'https://acdn.adnxs.com/dmp/up/pixie.js';
injectScript(url, onSuccess, onFailure, url);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://acdn.adnxs.com/dmp/up/pixie.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pixie"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pixie.actionQueue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/09/2020, 10:12:40


